name: 'PR Validation'
description: 'Validate PR conventions and requirements'
outputs:
  approved:
    description: 'Whether PR validation passed'
    value: ${{ steps.final.outputs.approved }}
runs:
  using: 'composite'
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Validate conventional commits
      uses: wagoid/commitlint-github-action@v6
      with:
        configFile: .commitlintrc.json
        failOnWarnings: false

    - name: Validate PR title format
      uses: amannn/action-semantic-pull-request@v5
      env:
        GITHUB_TOKEN: ${{ github.token }}
      with:
        types: |
          feat
          fix
          docs
          style
          refactor
          perf
          test
          build
          ci
          chore
        scopes: |
          gui
          core
          overlay
          config
          build
          ci
          deps
        requireScope: false
        subjectPattern: ^[a-z].+$
        wip: false

    - name: Check branch naming convention
      uses: deepakputhraya/action-branch-name@master
      with:
        regex: '^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|hotfix)\/[a-z0-9-]+$|^(main|develop)$'
        allowed_prefixes: 'feat,fix,docs,style,refactor,perf,test,build,ci,chore,hotfix'
        ignore: main,develop
        min_length: 5

    - name: Check for merge conflicts
      uses: eps1lon/actions-label-merge-conflict@v3
      with:
        dirtyLabel: 'merge-conflict'
        repoToken: ${{ github.token }}

    - name: Final validation status
      id: final
      run: |
        echo "approved=true" >> $GITHUB_OUTPUT
        echo "âœ… PR validation completed"
      shell: bash
